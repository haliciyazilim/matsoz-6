function MyShapes(e,t,n,r){this.myType=t,this.pointsArr=[];for(var i=0;i<e.length;i++)this.pointsArr[i]=e[i];this.centerPoint=Util.centerOfPoints(this.pointsArr),this.strokeColor=n,this.fillColor=r,this.isFlipped=0,this.updatePointsArr=function(e){this.shape&&this.shape.remove(),this.pointsArr=[];for(var t=0;t<e.length;t++)this.pointsArr[t]=e[t];this.drawShape(this.strokeColor,this.fillColor),this.shape.parentObject=this,this.computeLinesArray(),this.computeCurrentAngle(),this.centerPoint=Util.centerOfPoints(this.pointsArr)},this.computeOriginalAngle=function(){var e;e=Util.findAngle(this.pointsArr[0].x,this.pointsArr[0].y,this.centerPoint.x,this.centerPoint.y),e=Util.radianToDegree(e),this.originalAngle=e},this.computeCurrentAngle=function(){var e;e=Util.findAngle(this.pointsArr[0].x,this.pointsArr[0].y,this.centerPoint.x,this.centerPoint.y),e=Util.radianToDegree(e),this.currentAngle=e},this.drawShape=function(t,n){var r=new Path;r.moveTo(e[0]);for(var i=0;i<this.pointsArr.length;i++)r.lineTo(this.pointsArr[i]);return r.lineTo(this.pointsArr[0]),r.closed=!0,r.strokeColor=t,r.fillColor=n,this.centerPoint=Util.centerOfPoints(this.pointsArr),r},this.shape=this.drawShape(n,r),this.shape.parentObject=this,this.originalPosition=this.shape.position,this.shape.isSnapped=!1,this.computeOriginalAngle(),this.computeCurrentAngle(),this.setPos=function(e){var t=e.subtract(this.shape.position);for(var n=0;n<this.pointsArr.length;n++)this.pointsArr[n]=this.pointsArr[n].add(t);this.shape.position=e,this.centerPoint=Util.centerOfPoints(this.pointsArr),this.computeLinesArray(),this.computeCurrentAngle()},this.setRotation=function(e){for(var t=0;t<this.pointsArr.length;t++)this.pointsArr[t]=this.pointsArr[t].getRotatedPoint(e,this.centerPoint);this.shape.rotate(e,this.centerPoint),this.centerPoint=Util.centerOfPoints(this.pointsArr),this.computeLinesArray(),this.computeCurrentAngle()},this.computeLinesArray=function(){this.linesArr=[];for(var e=0;e<this.pointsArr.length;e++){var t=this.pointsArr[e],n=this.pointsArr[(e+1)%this.pointsArr.length],r=Util.findAngle(t.x,t.y,n.x,n.y);while(r>Math.PI)r-=Math.PI;this.linesArr.push({p1:t,p2:n,angle:r})}},this.computeLinesArray(),this.trySnapTo=function(e){if(this.centerPoint.getDistance(e.centerPoint,!0)>1e3)return;this.myType==e.myType&&(this.myType==4?(Math.abs(this.currentAngle-e.currentAngle)%90<20||Math.abs(this.currentAngle-e.currentAngle)%90>70)&&this.centerPoint.getDistance(e.centerPoint,!0)<400&&(this.setRotation(this.currentAngle-e.currentAngle),this.setPos(e.shape.position),this.shape.isSnapped=!0,console.log("snapped")):this.myType==3?(Math.abs(this.currentAngle-e.currentAngle)%180<20||Math.abs(this.currentAngle-e.currentAngle)%180>160)&&this.centerPoint.getDistance(e.centerPoint,!0)<400&&(this.setRotation(this.currentAngle-e.currentAngle),this.setPos(e.shape.position),this.shape.isSnapped=!0,console.log("snapped")):this.isFlipped==e.isFlipped&&(Math.abs(this.currentAngle-e.currentAngle)<20||Math.abs(this.currentAngle-e.currentAngle)>340)&&this.centerPoint.getDistance(e.centerPoint,!0)<400&&(this.setRotation(this.currentAngle-e.currentAngle),this.setPos(e.shape.position),this.shape.isSnapped=!0,console.log("snapped")))}}function flipSelectedItem(){Interaction.rotItems&&Interaction.rotItems.remove(),Interaction.tangram.flipPiece4(),Interaction.rotatableItem=Interaction.tangram.pieces[3].shape,Interaction.rotItems=new Group;for(var e=0;e<Interaction.rotatableItem.parentObject.pointsArr.length;e++){var t=Interaction.rotatableItem.parentObject.pointsArr[e].findPointTo(Interaction.rotatableItem.parentObject.centerPoint,-10),n=Util.findAngle(Interaction.rotatableItem.parentObject.pointsArr[e].x,Interaction.rotatableItem.parentObject.pointsArr[e].y,Interaction.rotatableItem.position.x,Interaction.rotatableItem.position.y);n=Util.radianToDegree(n),n=225-n;var r=new Raster("rotationArrow");r.position=new Point(t),r.rotate(n,t);var i=new Path.Circle(t,10);i.fillColor="red",i.class="rotatable",i.opacity=0,Interaction.rotItems.addChild(i),Interaction.rotItems.addChild(r)}Interaction.rotatableItem.fillColor=interactionSelectedColors[Interaction.randomNumber],Interaction.rotatableItem.strokeColor=interactionSelectedColors[Interaction.randomNumber],Interaction.rotItems.class="rotatable",Interaction.rotatableItem.isSnapped==1&&(Interaction.rotatableItem.isSnapped=!1);for(var e=0;e<Interaction.questionTangram.pieces.length;e++)Interaction.rotatableItem.parentObject.trySnapTo(Interaction.questionTangram.pieces[e]);Interaction.rotItems&&Interaction.rotItems.remove(),Interaction.rotItems=new Group;for(var e=0;e<Interaction.rotatableItem.parentObject.pointsArr.length;e++){var t=Interaction.rotatableItem.parentObject.pointsArr[e].findPointTo(Interaction.rotatableItem.parentObject.centerPoint,-10),n=Util.findAngle(Interaction.rotatableItem.parentObject.pointsArr[e].x,Interaction.rotatableItem.parentObject.pointsArr[e].y,Interaction.rotatableItem.position.x,Interaction.rotatableItem.position.y);n=Util.radianToDegree(n),n=225-n;var r=new Raster("rotationArrow");r.position=new Point(t),r.rotate(n,t);var i=new Path.Circle(t,10);i.fillColor="red",i.class="rotatable",i.opacity=0,Interaction.rotItems.addChild(i),Interaction.rotItems.addChild(r)}Interaction.rotatableItem.fillColor=interactionSelectedColors[Interaction.randomNumber],Interaction.rotatableItem.strokeColor=interactionSelectedColors[Interaction.randomNumber],Interaction.rotItems.class="rotatable"}function generateTangramQuestions(){TangramQuestions=[[{point:new Point(325.5,154.5),angle:162},{point:new Point(356.5,124.5),angle:342},{point:new Point(229.5,215.5),angle:315},{point:new Point(281.5,206.5),angle:270,flip:0},{point:new Point(355.5,63.5),angle:0},{point:new Point(374.5,254.5),angle:45},{point:new Point(355.5,214.5),angle:117}],[{point:new Point(353.5,228.5),angle:162},{point:new Point(323.5,198.5),angle:72},{point:new Point(252.5,116.5),angle:135},{point:new Point(344.5,168.5),angle:0,flip:0},{point:new Point(335.5,61.5),angle:48},{point:new Point(293.5,98.5),angle:90},{point:new Point(323.5,126.5),angle:252}],[{point:new Point(326.5,156.5),angle:252},{point:new Point(326.5,216.5),angle:72},{point:new Point(280.5,187.5),angle:0},{point:new Point(296.5,125.5),angle:135,flip:1},{point:new Point(355.5,74.5),angle:50},{point:new Point(352.5,38.5),angle:275},{point:new Point(326.5,246.5),angle:27}],[{point:new Point(315.5,178.5),angle:252},{point:new Point(252.5,169.5),angle:207},{point:new Point(375.5,73.5),angle:91},{point:new Point(361.5,132.5),angle:315,flip:0},{point:new Point(315.5,119.5),angle:0},{point:new Point(360.5,89.5),angle:180},{point:new Point(273.5,148.5),angle:161}],[{point:new Point(340.5,183.5),angle:167},{point:new Point(307.5,156.5),angle:78},{point:new Point(277.5,232.5),angle:90},{point:new Point(322.5,232.5),angle:315,flip:1},{point:new Point(253.5,196.5),angle:315},{point:new Point(263.5,164.5),angle:136},{point:new Point(313.5,95.5),angle:257}],[{point:new Point(310.5,231.5),angle:27},{point:new Point(302.5,166.5),angle:72},{point:new Point(258.5,76.5),angle:0},{point:new Point(377.5,237.5),angle:135,flip:1},{point:new Point(243.5,106.5),angle:0},{point:new Point(227.5,76.5),angle:181},{point:new Point(272.5,148.5),angle:252}],[{point:new Point(344.5,189.5),angle:342},{point:new Point(306.5,223.5),angle:297},{point:new Point(257.5,172.5),angle:180},{point:new Point(287.5,97.5),angle:225,flip:1},{point:new Point(272.5,142.5),angle:0},{point:new Point(262.5,84.5),angle:135},{point:new Point(285.5,202.5),angle:252}],[{point:new Point(285.5,183.5),angle:252},{point:new Point(277.5,247.5),angle:297},{point:new Point(330.5,182.5),angle:181},{point:new Point(348.5,67.5),angle:290,flip:0},{point:new Point(337.5,123.5),angle:315},{point:new Point(330.5,211.5),angle:359},{point:new Point(312.5,70.5),angle:257}],[{point:new Point(318.5,142.5),angle:297},{point:new Point(360.5,185.5),angle:117},{point:new Point(281.5,162.5),angle:0},{point:new Point(319.5,63.5),angle:135,flip:1},{point:new Point(275.5,100.5),angle:315},{point:new Point(306.5,217.5),angle:0},{point:new Point(352.5,218.5),angle:297}],[{point:new Point(351.5,248.5),angle:27},{point:new Point(342.5,184.5),angle:72},{point:new Point(387.5,239.5),angle:180},{point:new Point(295.5,76.5),angle:340,flip:0},{point:new Point(291.5,145.5),angle:45},{point:new Point(301.5,216.5),angle:135},{point:new Point(262.5,94.5),angle:297}],[{point:new Point(296.5,243.5),angle:27},{point:new Point(338.5,243.5),angle:297},{point:new Point(390.5,84.5),angle:135},{point:new Point(319.5,160.5),angle:0,flip:0},{point:new Point(317.5,63.5),angle:0},{point:new Point(243.5,84.5),angle:45},{point:new Point(316.5,94.5),angle:342}],[{point:new Point(326.5,194.5),angle:297},{point:new Point(286.5,194.5),angle:27},{point:new Point(409.5,230.5),angle:90},{point:new Point(320.5,115.5),angle:225,flip:1},{point:new Point(343.5,66.5),angle:329},{point:new Point(208.5,225.5),angle:314},{point:new Point(366.5,131.5),angle:297}],[{point:new Point(281.5,231.5),angle:162},{point:new Point(311.5,201.5),angle:252},{point:new Point(382.5,116.5),angle:45},{point:new Point(291.5,169.5),angle:180,flip:1},{point:new Point(292.5,61.5),angle:39},{point:new Point(341.5,99.5),angle:90},{point:new Point(312.5,127.5),angle:72}],[{point:new Point(309.5,117.5),angle:162},{point:new Point(289.5,168.5),angle:207},{point:new Point(253.5,224.5),angle:0},{point:new Point(319.5,211.5),angle:315,flip:0},{point:new Point(313.5,65.5),angle:310},{point:new Point(335.5,241.5),angle:270},{point:new Point(369.5,86.5),angle:27}],[{point:new Point(369.5,121.5),angle:317},{point:new Point(329.5,136.5),angle:137},{point:new Point(232.5,107.5),angle:245},{point:new Point(351.5,196.5),angle:200,flip:0},{point:new Point(384.5,64.5),angle:355},{point:new Point(394.5,249.5),angle:65},{point:new Point(279.5,146.5),angle:317}],[{point:new Point(247.5,157.5),angle:162},{point:new Point(286.5,218.5),angle:342},{point:new Point(361.5,78.5),angle:180},{point:new Point(330.5,144.5),angle:315,flip:0},{point:new Point(262.5,111.5),angle:30},{point:new Point(420.5,203.5),angle:91},{point:new Point(359.5,188.5),angle:162}],[{point:new Point(339.5,184.5),angle:118},{point:new Point(339.5,142.5),angle:28},{point:new Point(332.5,280.5),angle:134},{point:new Point(298.5,111.5),angle:315,flip:1},{point:new Point(354.5,58.5),angle:320},{point:new Point(351.5,22.5),angle:275},{point:new Point(331.5,218.5),angle:298}],[{point:new Point(321.5,93.5),angle:162},{point:new Point(345.5,154.5),angle:342},{point:new Point(232.5,152.5),angle:44},{point:new Point(299.5,169.5),angle:225,flip:0},{point:new Point(304.5,45.5),angle:323},{point:new Point(396.5,248.5),angle:181},{point:new Point(380.5,191.5),angle:252}],[{point:new Point(280.5,113.5),angle:162},{point:new Point(324.5,97.5),angle:252},{point:new Point(263.5,218.5),angle:315},{point:new Point(367.5,190.5),angle:1,flip:0},{point:new Point(269.5,60.5),angle:315},{point:new Point(383.5,248.5),angle:45},{point:new Point(315.5,177.5),angle:27}]]}var Tangram=Class.extend({init:function(){},drawPieces:function(e,t,n,r){if(e==null||e==undefined)e=new Point(0,0);if(t==null||t==undefined)t=120;this.strokeColor=n,this.fillColor=r,this.size=t;var i=new Point(e.x,e.y),s=new Point(e.x+t,e.y),o=new Point(e.x+t*.5,e.y+t*.5),u=new Point(e.x,e.y+t),a=new Point(e.x,e.y),f=new Point(e.x+t*.5,e.y+t*.5),l=new Point(e.x+t*.5,e.y+t*.5),c=new Point(e.x+t*.75,e.y+t*.25),h=new Point(e.x+t*.75,e.y+t*.75),p=new Point(e.x+t*.75,e.y+t*.25),d=new Point(e.x+t,e.y),v=new Point(e.x+t,e.y+t*.5),m=new Point(e.x+t*.75,e.y+t*.75),g=new Point(e.x+t*.25,e.y+t*.75),y=new Point(e.x+t*.5,e.y+t*.5),b=new Point(e.x+t*.75,e.y+t*.75),w=new Point(e.x+t*.5,e.y+t),E=new Point(e.x+t*.25,e.y+t*.75),S=new Point(e.x,e.y+t),x=new Point(e.x+t*.5,e.y+t),T=new Point(e.x+t*.5,e.y+t),N=new Point(e.x+t,e.y+t*.5),C=new Point(e.x+t,e.y+t);this.animatePoints=[],this.animatePoints[0]=new Point(-2,-3),this.animatePoints[1]=new Point(-4,-1),this.animatePoints[2]=new Point(1,-1),this.animatePoints[3]=new Point(4,-4),this.animatePoints[4]=new Point(-2,2),this.animatePoints[5]=new Point(-4,4),this.animatePoints[6]=new Point(3,2),this.pieces=[];var k=[];k[0]=new Point(i),k[1]=new Point(s),k[2]=new Point(o),this.pieces[0]=new MyShapes(k,1,n,r),this.pieces[0].shape.class="draggable";var L=[];L[0]=new Point(u),L[1]=new Point(a),L[2]=new Point(f),this.pieces[1]=new MyShapes(L,1,n,r),this.pieces[1].shape.class="draggable";var A=[];A[0]=new Point(l),A[1]=new Point(c),A[2]=new Point(h),this.pieces[2]=new MyShapes(A,2,n,r),this.pieces[2].shape.class="draggable";var O=[];O[0]=new Point(p),O[1]=new Point(d),O[2]=new Point(v),O[3]=new Point(m),this.pieces[3]=new MyShapes(O,3,n,r),this.pieces[3].shape.class="draggable";var M=[];M[0]=new Point(g),M[1]=new Point(y),M[2]=new Point(b),M[3]=new Point(w),this.pieces[4]=new MyShapes(M,4,n,r),this.pieces[4].shape.class="draggable";var _=[];_[0]=new Point(E),_[1]=new Point(S),_[2]=new Point(x),this.pieces[5]=new MyShapes(_,2,n,r),this.pieces[5].shape.class="draggable";var D=[];D[0]=new Point(T),D[1]=new Point(N),D[2]=new Point(C),this.pieces[6]=new MyShapes(D,5,n,r),this.pieces[6].shape.class="draggable"},animatePieces:function(e){if(this.pieces){var t=new AnimationHelper({myPoint:new Point(0,0)}),n=new AnimationHelper({myPoint:new Point(0,0)}),r=new AnimationHelper({myPoint:new Point(0,0)}),i=new AnimationHelper({myPoint:new Point(0,0)}),s=new AnimationHelper({myPoint:new Point(0,0)}),o=new AnimationHelper({myPoint:new Point(0,0)}),u=new AnimationHelper({myPoint:new Point(0,0)}),a=this.pieces[0],f=this.pieces[1],l=this.pieces[2],c=this.pieces[3],h=this.pieces[4],p=this.pieces[5],d=this.pieces[6],v=this.pieces[0].shape.position,m=this.pieces[1].shape.position,g=this.pieces[2].shape.position,y=this.pieces[3].shape.position,b=this.pieces[4].shape.position,w=this.pieces[5].shape.position,E=this.pieces[6].shape.position,S=this;t.animate({style:{myPoint:new Point(S.animatePoints[0])},duration:1e3,delay:e,animationType:"easeInOutQuad",update:function(){a.setPos(new Point(v.add(this.myPoint)))},callback:function(){a.originalPosition=a.shape.position}}),n.animate({style:{myPoint:new Point(S.animatePoints[1])},duration:1e3,delay:e,animationType:"easeInOutQuad",update:function(){f.setPos(new Point(m.add(this.myPoint)))},callback:function(){f.originalPosition=f.shape.position}}),r.animate({style:{myPoint:new Point(S.animatePoints[2])},duration:1e3,delay:e,animationType:"easeInOutQuad",update:function(){l.setPos(new Point(g.add(this.myPoint)))},callback:function(){l.originalPosition=l.shape.position}}),i.animate({style:{myPoint:new Point(S.animatePoints[3])},duration:1e3,delay:e,animationType:"easeInOutQuad",update:function(){c.setPos(new Point(y.add(this.myPoint)))},callback:function(){c.originalPosition=c.shape.position}}),s.animate({style:{myPoint:new Point(S.animatePoints[4])},duration:1e3,delay:e,animationType:"easeInOutQuad",update:function(){h.setPos(new Point(b.add(this.myPoint)))},callback:function(){h.originalPosition=h.shape.position}}),o.animate({style:{myPoint:new Point(S.animatePoints[5])},duration:1e3,delay:e,animationType:"easeInOutQuad",update:function(){p.setPos(new Point(w.add(this.myPoint)))},callback:function(){p.originalPosition=p.shape.position}}),u.animate({style:{myPoint:new Point(S.animatePoints[6])},duration:1e3,delay:e,animationType:"easeInOutQuad",update:function(){d.setPos(new Point(E.add(this.myPoint)))},callback:function(){d.originalPosition=d.shape.position}})}},flipPiece4:function(){var e=this.pieces[3].pointsArr,t=this.pieces[3].shape,n=[],r=this.pieces[3].originalAngle,i=this.pieces[3].originalPosition,s=this.pieces[3].isFlipped,o=e[0].add((t.position.x-e[0].x)*2,0),u=e[1].add((t.position.x-e[1].x)*2,0),a=e[2].add((t.position.x-e[2].x)*2,0),f=e[3].add((t.position.x-e[3].x)*2,0);n[0]=new Point(o),n[1]=new Point(u),n[2]=new Point(a),n[3]=new Point(f),this.pieces[3]&&(this.pieces[3].shape.remove(),this.pieces[3]=null),this.pieces[3]=new MyShapes(n,3,this.strokeColor,this.fillColor),this.pieces[3].shape.class="draggable",this.pieces[3].originalAngle=r,this.pieces[3].originalPosition=i,s==0?this.pieces[3].isFlipped=1:s==1&&(this.pieces[3].isFlipped=0)}});