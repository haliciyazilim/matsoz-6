/**
 * Created with JetBrains WebStorm.
 * User: yeguzel
 * Date: 23.10.2012
 * Time: 06:58
 * To change this template use File | Settings | File Templates.
 */
var Shape3=Class.extend({init:function(e){this.points=[],this.dY=.3,this.h=30,this.a=30,this.dX=.4,this.style={strokeColor:"#687",fillColor:new RgbColor(.6,.8,.7,.9)}},redraw:function(){this.draw(this.zeroPoint)},draw:function(e){this.zeroPoint=e;var t=Shape3.CreateProjectionMatrixForObjectAt(e.x,e.y);this.points.sort(Shape3.SortFunction),this.cubes=[];for(var n=0;n<this.points.length;n++){var r=new ExpandablePrism(this.a,this.a,this.a,t);r.transform(this.points[n].multiply(new Point3(this.a,-this.a,-this.a))),r.project(),this.cubes.push(r)}},rotateByY:function(e){for(var t=0;t<this.points.length;t++){var n=this.points[t].x;this.points[t].x=(e?-1:1)*this.points[t].z,this.points[t].z=(e?1:-1)*n}},rotateByX:function(e){for(var t=0;t<this.points.length;t++){var n=this.points[t].y;this.points[t].y=(e?-1:1)*this.points[t].z,this.points[t].z=(e?1:-1)*n}},rotateByZ:function(e){for(var t=0;t<this.points.length;t++){var n=this.points[t].y;this.points[t].y=(e?-1:1)*this.points[t].x,this.points[t].x=(e?1:-1)*n}},setRotationX:function(e){for(var t=0;t<this.cubes.length;t++)this.cubes[t].setRotationX(e),this.cubes[t].project()},setRotationY:function(e){for(var t=0;t<this.cubes.length;t++)this.cubes[t].setRotationY(e),this.cubes[t].project()},setRotationZ:function(e){for(var t=0;t<this.cubes.length;t++)this.cubes[t].setRotationZ(e),this.cubes[t].project()},showLeftSide:function(){this.rotateByY(!1),this.redraw()},showRightSide:function(){this.rotateByY(!0),this.redraw()},showUpSide:function(){this.rotateByX(!0),this.redraw()},showDownSide:function(){this.rotateByX(!1),this.redraw()},showBackSide:function(){this.rotateByY(),this.rotateByY(),this.redraw()},showCorrectSide:function(e){var t=Math.PI/4;switch(e){case Shape3.LeftSide:t*=-1;break;case Shape3.RightSide:t*=1;break;case Shape3.DownSide:t*=-1;break;case Shape3.UpSide:t*=1;break;case Shape3.BackSide:t*=-2}var n=new AnimationHelper({rotation:0});n.animate({style:{rotation:-Math.PI/2},duration:1e3,delay:500,update:function(){Interaction.shape.setRotationY(this.rotation)},callback:function(){Interaction.shape.removeCubes(),this.rotation=-this.rotation,Interaction.shape.showBackSide(),Interaction.shape.setRotationY(this.rotation),this.animate({style:{rotation:0},duration:1e3,update:function(){Interaction.shape.setRotationY(this.rotation)},callback:function(){Interaction.shape.flatten(1e3,500)}})}})},flatten:function(e,t){var n=new AnimationHelper({zFactor:3}),r=this;n.animate({style:{zFactor:0},duration:e,delay:t,animationType:"easeInEaseOut",update:function(){console.log(this.zFactor);var e=Shape3.CreateProjectionMatrixForObjectAt(r.zeroPoint.x,r.zeroPoint.y,this.zFactor);for(var t=0;t<r.cubes.length;t++)r.cubes[t].matrix=e,r.cubes[t].project()}})},removeCubes:function(){if(this.cubes)for(var e=0;e<this.cubes.length;e++)this.cubes[e].remove()}});Shape3.Generate=function(e){var t;switch(e){case 0:t=new TShape3}return t},Shape3.SortFunction=function(e,t){return e.z>t.z?1:e.z<t.z?-1:e.y>t.y?1:e.y<t.y?-1:e.x>t.x?1:e.x<t.x?-1:0},Shape3.CreateProjectionMatrixForObjectAt=function(e,t,n){var r=1024;return n==undefined&&(n=3),[1,0,128*n/r,e,0,1,-128*n/r,t,0,0,0,1,0,0,0,1]},Shape3.FrontSide="Front",Shape3.DownSide="Down",Shape3.UpSide="Up",Shape3.LeftSide="Left",Shape3.RightSide="Right",Shape3.BackSide="Back";