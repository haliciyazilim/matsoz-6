function InteractiveGrids(e){this.id=InteractiveGrids.GetId(),e.rows?this.rows=e.rows:this.rows=8,e.cols?this.cols=e.cols:this.cols=8,this.vertexLetters=e.vertexLetters,this.size=e.size,this.position=e.position,this.style=e.style,this.points=[],this.vertexes=[],this.circles=[],this.lines=[];for(var t=0;t<=this.rows;t++)this.lines.push((new Path.Line(this.position.add(0,this.size*t),this.position.add(this.size*this.cols,this.size*t))).set_style(this.style));for(var t=0;t<=this.cols;t++)this.lines.push((new Path.Line(this.position.add(this.size*t,0),this.position.add(this.size*t,this.size*this.rows))).set_style(this.style));for(var t=0;t<=this.rows;t++)for(var n=0;n<=this.cols;n++){var r=this.position.add(this.size*t,this.size*n),i=new Path.Circle(r,this.size*.3);i.set_style({fillColor:new RgbColor(1,1,1,0)}),i.class="InteractiveGridCircles"+this.id,this.circles.push(i)}return this}function PantographShapes(e,t){this.pointsArr=[];for(var n=0;n<e.length;n++)this.pointsArr[n]=e[n];return this.centerPoint=Util.centerOfPoints(this.pointsArr),this.drawShape=function(){var e=new Group,n=new Path;n.moveTo(this.pointsArr[0].x,this.pointsArr[0].y-t),n.lineTo(this.pointsArr[1].x,this.pointsArr[1].y-t),n.lineTo(this.pointsArr[1].x,this.pointsArr[1].y+t),n.lineTo(this.pointsArr[1].x,this.pointsArr[0].y+t),n.lineTo(this.pointsArr[0].x,this.pointsArr[0].y-t),n.closed=!0,n.strokeColor=pantographShapesStrokeColor,n.fillColor=pantographShapesFillColor,n.strokeCap="round",this.centerPoint=Util.centerOfPoints(this.pointsArr);var r=Util.centerOfPoints([this.pointsArr[0],this.pointsArr[3]]);r=r.findPointTo(this.centerPoint,7);var i=new Path.Circle(r,2);i.fillColor="#333";var s=Util.centerOfPoints([this.pointsArr[1],this.pointsArr[2]]);s=s.findPointTo(this.centerPoint,7);var o=new Path.Circle(s,2);return o.fillColor="#333",e.addChild(n),e.addChild(i),e.addChild(o),e},this.shape=this.drawShape(),this.shape.parentObject=this,this.setPos=function(e){var t=e.subtract(this.shape.position);for(var n=0;n<this.pointsArr.length;n++)this.pointsArr[n]=this.pointsArr[n].add(t);this.shape.position=e,this.centerPoint=Util.centerOfPoints(this.pointsArr),this.computeCurrentAngle()},this.computeOriginalAngle=function(){var e;e=Util.findAngle(this.pointsArr[0].x,this.pointsArr[0].y,this.centerPoint.x,this.centerPoint.y),e=Util.radianToDegree(e),this.originalAngle=e},this.computeCurrentAngle=function(){var e;e=Util.findAngle(this.pointsArr[0].x,this.pointsArr[0].y,this.centerPoint.x,this.centerPoint.y),e=Util.radianToDegree(e),this.currentAngle=e},this.computeOriginalAngle(),this.computeCurrentAngle(),this.setRotation=function(e){for(var t=0;t<this.pointsArr.length;t++)this.pointsArr[t]=this.pointsArr[t].getRotatedPoint(e,this.centerPoint);this.shape.rotate(e,this.centerPoint),this.centerPoint=Util.centerOfPoints(this.pointsArr),this.computeCurrentAngle()},this}function __Styles(){animationShapeStyle={strokeColor:"#666",fillColor:new RgbColor(.8,.8,.8,.6)},interactionShapeStyle={strokeColor:"#687",fillColor:new RgbColor(.6,.8,.7,.8)}}InteractiveGrids.prototype.activateRemoveOnClick=function(){this.removeOnClick=!0},InteractiveGrids.prototype.removeShape=function(){this.path.remove();for(var e=0;e<this.vertexes.length;e++)this.vertexes[e].remove();this.vertexes=[];for(var e=0;e<this.points.length;e++)this.points[e].class="InteractiveGridCircles"+this.id;this.path.remove(),this.disableDraw=!1,this.points=[],this.createTool()},InteractiveGrids.prototype.drawShape=function(e){this.path=new Path,this.path.set_style(this.style).set_style({strokeWidth:3,strokeCap:"butt",strokeColor:"#000"});if(e){for(var t=0;t<e.length;t++){var n=e[t].multiply(this.size,this.size).add(this.position);this.points.push(n),this.path.add(n)}this.path.closed=!0,this.appendVertexLetters()}return this},InteractiveGrids.prototype.undo=function(){if(this.path.closed==1){this.path.closed=!1,this.disableDraw=!1;return}this.path.removeSegment(this.path.segments.length-1),this.points.pop(),this.appendVertexLetters();var e=this.vertexes.pop();e.baseCircle.class="InteractiveGridCircles"+this.id,e.remove()},InteractiveGrids.prototype.appendVertexLetters=function(){if(this.vertexLetters==undefined)return;var e=[];for(var t=0;t<this.vertexLetters.length;t++)e.push(this.vertexLetters[t]);if(this.vertexPointTexts)for(var t=0;t<this.vertexPointTexts.length;t++)this.vertexPointTexts[t].remove();this.vertexPointTexts=[];var n=Util.centerOfPoints(this.points);for(var t=0;t<this.points.length;t++){var r=new PointText(this.points[t].findPointTo(n,-13).add(0,6));r.content=e.shift(),r.set_style({fontSize:12,justification:"center",strokeWidth:2,strokeColor:"#000"}),this.vertexPointTexts.push(r)}},InteractiveGrids.prototype.createTool=function(){var e=new Tool,t=this;return this.disableDraw=!1,e.onMouseDown=function(e){if(t.removeOnClick==1){t.removeShape();return}if(t.disableDraw==1)return;if(e.item&&e.item.class=="InteractiveGridCircles"+t.id){e.item.set_style({});var n=(new Path.Circle(e.item.position,4)).set_style({fillColor:new RgbColor(.2,.2,.2),"class":"SelectedGridCircles"+t.id});n.baseCircle=e.item,t.vertexes.push(n),t.path.add(e.item.position),e.item.class="SelectedGridCircles"+t.id,e.item.opacity=1,t.points.push(e.item.position),e.item.insertAbove(t.path),t.appendVertexLetters()}else e.item&&e.item.class=="SelectedGridCircles"+t.id&&t.points.length>2&&(t.path.closed=!0,t.disableDraw=!0)},e.activate(),this},InteractiveGrids.CreateShape=function(e){var t=[],n=new Point(1,1),r=new Point(0,0);switch(e){case 0:t.push(new Point(1,0)),t.push(new Point(0,2)),t.push(new Point(3,2)),n=new Point(Util.randomInteger(1,3),Util.randomInteger(1,3)),r=new Point(Util.randomInteger(1,3),Util.randomInteger(1,3));break;case 1:t.push(new Point(0,2)),t.push(new Point(2,2)),t.push(new Point(1,0));var i=Util.randomInteger(1,3);n=new Point(i,i),r=new Point(Util.randomInteger(1,5),Util.randomInteger(1,5));break;case 2:t.push(new Point(0,0)),t.push(new Point(0,1)),t.push(new Point(1,1)),n=new Point(Util.randomInteger(1,5),Util.randomInteger(1,5)),r=new Point(Util.randomInteger(1,5),Util.randomInteger(1,5));break;case 3:t.push(new Point(1,1)),t.push(new Point(1,0)),t.push(new Point(0,1)),n=new Point(Util.randomInteger(1,5),Util.randomInteger(1,5)),r=new Point(Util.randomInteger(1,5),Util.randomInteger(1,5));break;case 4:t.push(new Point(0,2)),t.push(new Point(2,2)),t.push(new Point(3,0)),n=new Point(Util.randomInteger(1,3),Util.randomInteger(1,3)),r=new Point(Util.randomInteger(1,3),Util.randomInteger(1,3));break;case 5:t.push(new Point(2,0)),t.push(new Point(2,2)),t.push(new Point(0,2)),t.push(new Point(0,0)),n=new Point(Util.randomInteger(1,3),Util.randomInteger(1,3)),r=new Point(Util.randomInteger(1,3),Util.randomInteger(1,3));break;case 6:t.push(new Point(0,0)),t.push(new Point(1,2)),t.push(new Point(3,2)),t.push(new Point(2,0)),n=new Point(Util.randomInteger(1,3),Util.randomInteger(1,3)),r=new Point(Util.randomInteger(1,3),Util.randomInteger(1,3));break;case 7:t.push(new Point(1,0)),t.push(new Point(0,2)),t.push(new Point(3,2)),t.push(new Point(5,0)),n=new Point(1,Util.randomInteger(1,3)),r=new Point(Util.randomInteger(1,3),Util.randomInteger(1,3));break;case 8:t.push(new Point(0,2)),t.push(new Point(1,4)),t.push(new Point(3,4)),t.push(new Point(4,2)),t.push(new Point(2,0)),r=new Point(Util.randomInteger(1,4),Util.randomInteger(1,4));break;case 9:t.push(new Point(0,2)),t.push(new Point(1,4)),t.push(new Point(4,5)),t.push(new Point(5,2)),t.push(new Point(2,0)),r=new Point(Util.randomInteger(1,4),Util.randomInteger(1,4));break;case 10:t.push(new Point(0,2)),t.push(new Point(1,4)),t.push(new Point(3,4)),t.push(new Point(4,2)),t.push(new Point(3,0)),t.push(new Point(1,0)),r=new Point(Util.randomInteger(1,4),Util.randomInteger(1,4));break;case 11:t.push(new Point(0,2)),t.push(new Point(1,3)),t.push(new Point(3,4)),t.push(new Point(4,2)),t.push(new Point(3,0)),t.push(new Point(1,1)),r=new Point(Util.randomInteger(1,4),Util.randomInteger(1,4))}for(var s=0;s<t.length;s++)t[s]=t[s].multiply(n).add(r);return t},InteractiveGrids.AreShapesSame=function(e,t){return InteractiveGrids.AreShapesSimilar(e,t,1)},InteractiveGrids.AreShapesSimilar=function(e,t,n){if(e.length!=t.length)return!1;function r(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n],i=e[(n-1+e.length)%e.length],s=e[(n+1)%e.length],o=Math.abs(Util.findAngle(r.x,r.y,s.x,s.y)-Util.findAngle(r.x,r.y,i.x,i.y));o=Util.radianToDegree(o),o>180&&(o=360-o),t.push([r.getDistance(s,!0),r.getDistance(i,!0),o,r])}return t}var i=r(e),s=r(t),o=0;for(var u=0;u<i.length;u++)o<i[u][0]&&(o=i[u][0]);var a=0;for(var u=0;u<s.length;u++)a<s[u][0]&&(a=s[u][0]);var f;n==undefined?f=o/a:f=n;var l=1e-5,c=i.length;function h(e,t,n){for(var r=0;r<=c;r++){var i=!0;for(var s=0;s<=c;s++){var o=(s+r+c)%c;if(e[s%c][2]==t[o][2]){var u=e[s%c][0]/t[o][n?1:0];if(f+l>u&&f-l<u)continue;i=!1}else i=!1}if(i==1)return InteractiveGrids.MoveShapeTo(e,t,r,n),!0}}return h(i,s,false)==1?!0:h(i,s,true)==1?!0:(i=i.reverse(),h(i,s,false)==1?!0:h(i,s,true)==1?!0:!1)},InteractiveGrids.GetId=function(){return InteractiveGrids.order?InteractiveGrids.order++:(InteractiveGrids.order=1,InteractiveGrids.GetId())},InteractiveGrids.MoveShapeTo=function(e,t,n,r){if(e.length!=t.length)return;var i,s=new AnimationHelper({}),o={};console.log("reverse: "+r);for(var u=0;u<e.length;u++)o["point"+u]=e[u][3],s["point"+u]=t[(u+n+t.length-(r===!0&&t.length>3?0:0))%t.length][3];s.animate({style:o,duration:2e3,animationType:"easeInEaseOut",update:function(){i&&i.remove(),i=new Path;for(var e=0;!0;e++){if(!this["point"+e])break;i.add(this["point"+e])}i.closed=!0,i.strokeColor="#000",i.strokeWidth=2},callback:function(){Interaction.resume()}})};var ShapePattern=Class.extend({init:function(e){e.position?this.position=e.position:this.position=new Point(0,0),e.number&&(this.number=e.number),e.pieceType&&(this.pieceType=e.pieceType),e.pieceStyle&&(this.pieceStyle=e.pieceStyle)},generateShapePoints:function(){this.shapePoints=[new Point(0,0)]},isEqual:function(e){this.generateShapePoints(!0),e.generateShapePoints(!0);if(this.shapePoints.length!=e.shapePoints.length)return!1;var t=this.shapePoints.length,n=[];for(var r=0;r<t;r++)n.push(!1);for(var r=0;r<t;r++)for(var i=0;i<t;i++)this.shapePoints[r].equals(e.shapePoints[i])&&(n[r]=!0);this.generateShapePoints(),e.generateShapePoints();for(var r=0;r<t;r++)if(n[r]==0)return!1;return!0},drawAPiece:function(e,t){return PieceFactory({type:this.pieceType,upperLeftPosition:e,gridSize:t,style:this.pieceStyle})},getWidth:function(){this.generateShapePoints(!0);var e=[];for(var t=0;t<this.shapePoints.length;t++)e[t]=0;for(var t=0;t<this.shapePoints.length;t++)e[this.shapePoints[t].y]++;var n=0;for(var t=0;t<e.length;t++)n<e[t]&&(n=e[t]);return n}});InteractiveGrids.prototype.cleanGrids=function(e,t){for(var n=0;n<this.pieces.length;n++)e==undefined?this.pieces[n].remove():this.pieces[n].animate({style:{opacity:0},duration:e,delay:t,callback:function(){this.remove()}});this.pieces=[]},InteractiveGrids.prototype.drawPattern=function(e){var t=[];e.generateShapePoints();for(var n=0;n<e.shapePoints.length;n++)t.push(this.extractAbsolutePointFromGridPoint(e.shapePoints[n].multiply(1,-1).add(0,this.rows-1)));var r=[];for(var n=0;n<t.length;n++)r.push(e.drawAPiece(t[n],this.size));return r},InteractiveGrids.prototype.createTool=function(e){var t=new Tool,n=this;this.inputPattern=new window[e]({}),this.inputPattern.pieceType=Interaction.pieceType,this.inputPattern.pieceStyle=Interaction.pieceStyle,this.pieces=[],t.onMouseDown=function(e){if(this.down==1)return;this.down=!0;var t=n.extractGridPointFromAbsolutePoint(e.point);for(var r=0;r<n.pieces.length;r++)if(n.pieces[r]&&n.pieces[r].gridPoint.equals(t)){t=!1,n.pieces[r].remove(),n.pieces.splice(r,1);break}if(t!=0){var i=n.inputPattern.drawAPiece(n.extractAbsolutePointFromGridPoint(t),n.size);i.gridPoint=t,n.pieces.push(i)}},t.onMouseUp=function(e){this.down=!1},t.activate()},InteractiveGrids.prototype.getInputPattern=function(){this.inputPattern.shapePoints=[],this.inputPoints=[],this.inputPattern.generateShapePoints=function(){return this.shapePoints};if(this.pieces.length==0)return this.inputPattern;for(var e=0;e<this.pieces.length;e++)this.pieces[e]!=undefined&&this.inputPoints.push(this.pieces[e].gridPoint);for(var e=0;e<this.inputPoints.length;e++)this.inputPattern.shapePoints[e]=this.inputPoints[e].subtract(0,this.rows).multiply(1,-1);var t=this.inputPattern.shapePoints[0].x,n=this.inputPattern.shapePoints[0].y;for(var e=1;e<this.inputPoints.length;e++)t>this.inputPattern.shapePoints[e].x&&(t=this.inputPattern.shapePoints[e].x);for(var e=1;e<this.inputPoints.length;e++)n>this.inputPattern.shapePoints[e].y&&(n=this.inputPattern.shapePoints[e].y);for(var e=0;e<this.inputPoints.length;e++)this.inputPattern.shapePoints[e]=this.inputPattern.shapePoints[e].subtract(t,n);return this.inputPattern},InteractiveGrids.prototype.extractAbsolutePointFromGridPoint=function(e){return e.multiply(this.size,this.size).add(this.position)},InteractiveGrids.prototype.extractGridPointFromAbsolutePoint=function(e){e=e.subtract(this.position);var t=(new Point(Util.floor(e.x,this.size),Util.floor(e.y,this.size))).divide(this.size,this.size);return t.x>=this.cols?!1:t.x<0?!1:t.y>=this.rows?!1:t.y<0?!1:t};var TriangleShapePattern=ShapePattern.extend({init:function(e){this._super(e),this.patternStyle={strokeColor:"dark",fillColor:"red",opacity:.8}},generateShapePoints:function(e){e==undefined&&(e=!1),this.shapePoints=[];for(var t=0;t<this.number;t++)for(var n=0;n<=t;n++)this.shapePoints.push(new Point(n,t-n));if(!e)for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].add(this.position)}}),DoubleXShapePattern=ShapePattern.extend({init:function(e){this._super(e)},generateShapePoints:function(e){e==undefined&&(e=!1),this.shapePoints=[];switch(this.number){case 4:this.shapePoints.push(new Point(-3,2)),this.shapePoints.push(new Point(-3,-2)),this.shapePoints.push(new Point(3,-2)),this.shapePoints.push(new Point(3,2)),this.shapePoints.push(new Point(-2,-3)),this.shapePoints.push(new Point(-2,3)),this.shapePoints.push(new Point(2,3)),this.shapePoints.push(new Point(2,-3));case 3:this.shapePoints.push(new Point(2,-1)),this.shapePoints.push(new Point(-2,-1)),this.shapePoints.push(new Point(-2,1)),this.shapePoints.push(new Point(2,1)),this.shapePoints.push(new Point(1,2)),this.shapePoints.push(new Point(1,-2)),this.shapePoints.push(new Point(-1,-2)),this.shapePoints.push(new Point(-1,2));case 2:this.shapePoints.push(new Point(-1,0)),this.shapePoints.push(new Point(1,0)),this.shapePoints.push(new Point(0,1)),this.shapePoints.push(new Point(0,-1));case 1:this.shapePoints.push(new Point(0,0))}for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].add(this.number-1,0);if(!e)for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].add(this.position);else{var n=this.shapePoints[0].x,r=this.shapePoints[0].y;for(var t=1;t<this.shapePoints.length;t++)n>this.shapePoints[t].x&&(n=this.shapePoints[t].x);for(var t=1;t<this.shapePoints.length;t++)r>this.shapePoints[t].y&&(r=this.shapePoints[t].y);for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].subtract(n,r)}},getWidth:function(){return this.number<2?3:this.number*2-1}}),XPlusShapePattern=ShapePattern.extend({init:function(e){this._super(e)},generateShapePoints:function(e){e==undefined&&(e=!1),this.shapePoints=[new Point(1,1),new Point(-1,1),new Point(-1,-1),new Point(1,-1)];for(var t=0;t<this.number;t++)for(var n=0;t>0&&n<4||n==0&&t==n;n++){var r=new Point(t,t),i,s;switch(n%4){case 0:i=0,s=-1;break;case 1:i=1,s=0;break;case 2:i=-1,s=0;break;case 3:i=0,s=1}this.shapePoints.push(r.multiply(i,s))}for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].add(this.number-1,0);if(!e)for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].add(this.position);else{var o=this.shapePoints[0].x,u=this.shapePoints[0].y;for(var t=1;t<this.shapePoints.length;t++)o>this.shapePoints[t].x&&(o=this.shapePoints[t].x);for(var t=1;t<this.shapePoints.length;t++)u>this.shapePoints[t].y&&(u=this.shapePoints[t].y);for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].subtract(o,u)}},getWidth:function(){return this.number<2?3:this.number*2-1}}),PlusShapePattern=ShapePattern.extend({init:function(e){this._super(e),this.patternStyle={strokeColor:"dark",fillColor:"#3C9",strokeCap:"square"}},generateShapePoints:function(e){e==undefined&&(e=!1),this.shapePoints=[];for(var t=0;t<this.number;t++)for(var n=0;t>0&&n<4||n==0&&t==n;n++){var r=new Point(t,t),i,s;switch(n%4){case 0:i=0,s=-1;break;case 1:i=1,s=0;break;case 2:i=-1,s=0;break;case 3:i=0,s=1}this.shapePoints.push(r.multiply(i,s).add(this.number-1,0))}if(!e)for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].add(this.position);else{var o=this.shapePoints[0].x,u=this.shapePoints[0].y;for(var t=1;t<this.shapePoints.length;t++)o>this.shapePoints[t].x&&(o=this.shapePoints[t].x);for(var t=1;t<this.shapePoints.length;t++)u>this.shapePoints[t].y&&(u=this.shapePoints[t].y);for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].subtract(o,u)}},getWidth:function(){return this.number*2-1}}),HexagonShapePattern=ShapePattern.extend({init:function(e){this._super(e),this.patternStyle={strokeColor:"dark",fillColor:"#f99"}},generateShapePoints:function(e){e==undefined&&(e=!1),this.shapePoints=[];for(var t=0;t<this.number*this.number;t++)this.shapePoints.push(new Point(Math.floor(t/this.number),Math.floor(t%this.number)));if(!e)for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].add(this.position)},getWidth:function(){return this.number}}),QuestionMarkPattern=ShapePattern.extend({init:function(e){this._super(e)},generateShapePoints:function(e){this.shapePoints=[new Point(0,2)];if(!e)for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].add(this.position)},drawAPiece:function(e,t){var n=new Raster("question_mark");n.position=e.add(n.bounds.width*.5,n.bounds.height*.2)}}),TShapePattern=ShapePattern.extend({init:function(e){this._super(e)},getWidth:function(){return this.number*2-1},generateShapePoints:function(e){e==undefined&&(e=!1),this.shapePoints=[];switch(this.number){case 4:this.shapePoints.push(new Point(-3,0)),this.shapePoints.push(new Point(3,0)),this.shapePoints.push(new Point(0,3));case 3:this.shapePoints.push(new Point(-2,0)),this.shapePoints.push(new Point(2,0)),this.shapePoints.push(new Point(0,2));case 2:this.shapePoints.push(new Point(-1,0)),this.shapePoints.push(new Point(1,0)),this.shapePoints.push(new Point(0,1));case 1:this.shapePoints.push(new Point(0,0))}if(!e)for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].add(this.position);else{var n=this.shapePoints[0].x,r=this.shapePoints[0].y;for(var t=1;t<this.shapePoints.length;t++)n>this.shapePoints[t].x&&(n=this.shapePoints[t].x);for(var t=1;t<this.shapePoints.length;t++)r>this.shapePoints[t].y&&(r=this.shapePoints[t].y);for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].subtract(n,r)}}}),NumberPattern=ShapePattern.extend({init:function(e){this._super(e)},generateShapePoints:function(e){e==undefined&&(e=!1),this.shapePoints=[new Point(0,0)];if(!e)for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].add(this.position);else{var n=this.shapePoints[0].x,r=this.shapePoints[0].y;for(var t=1;t<this.shapePoints.length;t++)n>this.shapePoints[t].x&&(n=this.shapePoints[t].x);for(var t=1;t<this.shapePoints.length;t++)r>this.shapePoints[t].y&&(r=this.shapePoints[t].y);for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].subtract(n,r)}},drawAPiece:function(e,t){var n=new PointText(new Point(0,0));return n.content=(this.number-1)*3+1,n.set_style({fontSize:t,justification:"center"}),n.position=n.position.add(e).add(t*.5,t),n}}),XShapePattern=ShapePattern.extend({init:function(e){this._super(e),this.patternStyle={strokeColor:"dark",fillColor:"red",opacity:.8}},getWidth:function(){return this.number*2-1},generateShapePoints:function(e){e==undefined&&(e=!1),this.shapePoints=[];for(var t=0;t<this.number;t++)for(var n=0;t>0&&n<4||n==0&&t==n;n++){var r=new Point(t,t),i,s;switch(n%4){case 0:i=-1,s=-1;break;case 1:i=1,s=-1;break;case 2:i=-1,s=1;break;case 3:i=1,s=1}this.shapePoints.push(r.multiply(i,s).add(this.number-1,0))}if(!e)for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].add(this.position);else{var o=this.shapePoints[0].x,u=this.shapePoints[0].y;for(var t=1;t<this.shapePoints.length;t++)o>this.shapePoints[t].x&&(o=this.shapePoints[t].x);for(var t=1;t<this.shapePoints.length;t++)u>this.shapePoints[t].y&&(u=this.shapePoints[t].y);for(var t=0;t<this.shapePoints.length;t++)this.shapePoints[t]=this.shapePoints[t].subtract(o,u)}}}),PieceFactory=function(e){var t=new Path,n=e.gridSize;switch(e.type){case 1:var r=[new Point(0,n*.5),new Point(n*.25,n),new Point(n*.75,n),new Point(n,n*.5),new Point(n*.75,0),new Point(n*.25,0)];break;case 2:var r=[new Point(0,0),new Point(0,n),new Point(n,n)];break;case 3:var r=[new Point(n*.5,-0.5),new Point(n,n*.5-.5),new Point(n*.5,n-.5),new Point(0,n*.5-.5)];break;case 4:var r=[new Point(n*.5,0),new Point(0,n),new Point(n,n)];break;case 5:var r=[new Point(n*.5,0),new Point(0,n*.4),new Point(n*.2,n),new Point(n*.8,n),new Point(n,n*.4)];break;case 0:default:var r=[new Point(0,0),new Point(0,n),new Point(n,n),new Point(n,0)]}t.closed=!0;for(var i=0;i<r.length;i++)t.add(r[i]);var s=Util.centerOfPoints(r),o=new Group;console.log(e.disableLayers);if(e.disableLayers==undefined){console.log("I'm here");for(var i=1;i<=r.length;i++){var u=new Path;u.add(s),u.add(r[i-1]),u.add(r[i%r.length]),u.closed=!0,u.set_style({strokeColor:new RgbColor(0,0,0,0),fillColor:"#fff",opacity:Math.abs(i-r.length*.5-.25)/r.length}),u.position=u.position.add(e.upperLeftPosition),o.addChild(u)}}t.position=t.position.add(e.upperLeftPosition),e.style?t.set_style(e.style):t.set_style({strokeColor:"#000",fillColor:"#aaa"});var a=new Group;return a.addChild(t),a.addChild(o),a},Shape3=Class.extend({init:function(e){this.points=[],this.dY=.3,this.h=30,this.a=30,this.dX=.4,this.style=interactionShapeStyle},redraw:function(){this.removeCubes(),this.draw(this.zeroPoint)},draw:function(e){this.zeroPoint=e;var t=Shape3.CreateProjectionMatrixForObjectAt(e.x,e.y);this.points.sort(Shape3.SortFunction),this.cubes=[];for(var n=0;n<this.points.length;n++){var r=new ExpandablePrism(this.a,this.a,this.a,t);r.set_style(this.style),r.transform(this.points[n].multiply(new Point3(this.a,-this.a,-this.a))),r.project(),this.cubes.push(r)}},setOpacity:function(e){for(var t=0;t<this.cubes.length;t++)this.cubes[t].set_style({opacity:e}),this.cubes[t].project()},rotateByY:function(e){for(var t=0;t<this.points.length;t++){var n=this.points[t].x;this.points[t].x=(e?-1:1)*this.points[t].z,this.points[t].z=(e?1:-1)*n}},rotateByX:function(e){for(var t=0;t<this.points.length;t++){var n=this.points[t].y;this.points[t].y=(e?-1:1)*this.points[t].z,this.points[t].z=(e?1:-1)*n}},rotateByZ:function(e){for(var t=0;t<this.points.length;t++){var n=this.points[t].y;this.points[t].y=(e?-1:1)*this.points[t].x,this.points[t].x=(e?1:-1)*n}},setRotationX:function(e){for(var t=0;t<this.cubes.length;t++)this.cubes[t].setRotationX(e),this.cubes[t].project()},setRotationY:function(e){for(var t=0;t<this.cubes.length;t++)this.cubes[t].setRotationY(e),this.cubes[t].project()},setRotationZ:function(e){for(var t=0;t<this.cubes.length;t++)this.cubes[t].setRotationZ(e),this.cubes[t].project()},showLeftSide:function(e){this.rotateByY(!1),e&&this.redraw()},showRightSide:function(e){this.rotateByY(!0),e&&this.redraw()},showUpSide:function(e){this.rotateByX(!0),e&&this.redraw()},showDownSide:function(e){this.rotateByX(!1),e&&this.redraw()},showBackSide:function(e){this.rotateByY(),this.rotateByY(),e&&this.redraw()},showSide:function(e,t){switch(e){case Shape3.LeftSide:this.showLeftSide(t);break;case Shape3.RightSide:this.showRightSide(t);break;case Shape3.DownSide:this.showDownSide(t);break;case Shape3.UpSide:this.showUpSide(t);break;case Shape3.BackSide:this.showBackSide(t)}},getMinimizedFlattedPoints:function(e){var t=[];for(var n=0;n<this.points.length;n++)t.push(this.points[n].clone());this.showSide(e);var r=[];for(var n=0;n<this.points.length;n++)r.push(new Point(this.points[n].x,this.points[n].y));var i=[];for(var n=0;n<r.length;n++){var s=!1;for(var o=0;o<i.length;o++)r[n].equals(i[o])==1&&(s=!0);s===!1&&i.push(r[n])}return this.points=t,i},showCorrectSide:function(e){var t=Math.PI/4,n=null;switch(e){case Shape3.LeftSide:t*=-1,n="Y";break;case Shape3.RightSide:t*=1,n="Y";break;case Shape3.DownSide:t*=-1,n="X";break;case Shape3.UpSide:t*=1,n="X";break;case Shape3.BackSide:t*=-2,n="Y";break;default:this.flatten(1e3,500);return}var r=new AnimationHelper({rotation:0}),i=this;r.animate({style:{rotation:t},duration:1e3,delay:1e3,update:function(){i["setRotation"+n](this.rotation)},callback:function(){i.removeCubes(),this.rotation=-this.rotation,i.showSide(e,!0),i["setRotation"+n](this.rotation),this.animate({style:{rotation:0},duration:1e3,update:function(){i["setRotation"+n](this.rotation)},callback:function(){i.flatten(1e3,500)}})}})},flatten:function(e,t){var n=new AnimationHelper({zFactor:3}),r=this;n.animate({style:{zFactor:0},duration:e,delay:t,animationType:"easeInEaseOut",update:function(){console.log(this.zFactor);var e=Shape3.CreateProjectionMatrixForObjectAt(r.zeroPoint.x,r.zeroPoint.y,this.zFactor);for(var t=0;t<r.cubes.length;t++)r.cubes[t].matrix=e,r.cubes[t].project()},callback:function(){Interaction.resume()}})},removeCubes:function(){if(this.cubes)for(var e=0;e<this.cubes.length;e++)this.cubes[e].remove()}});Shape3.SortFunction=function(e,t){return e.z>t.z?1:e.z<t.z?-1:e.y>t.y?1:e.y<t.y?-1:e.x>t.x?1:e.x<t.x?-1:0},Shape3.CreateProjectionMatrixForObjectAt=function(e,t,n){var r=1024;return n==undefined&&(n=3),[1,0,128*n/r,e,0,1,-128*n/r,t,0,0,0,1,0,0,0,1]},Shape3.FrontSide="önden",Shape3.DownSide="alttan",Shape3.UpSide="üstten",Shape3.LeftSide="soldan",Shape3.RightSide="sağdan",Shape3.BackSide="arkadan",Array.prototype.normalizePoints=function(){var e=this[0].x,t=this[0].y;for(var n=1;n<this.length;n++)e>this[n].x&&(e=this[n].x);for(var n=1;n<this.length;n++)t>this[n].y&&(t=this[n].y);for(var n=0;n<this.length;n++)this[n]=this[n].subtract(e,t);return this},Array.prototype.equals=function(e){if(this.length!=e.length)return!1;var t=this.length,n=[];for(var r=0;r<t;r++)n.push(!1);for(var r=0;r<t;r++)for(var i=0;i<t;i++)this[r].equals(e[i])&&(n[r]=!0);for(var r=0;r<t;r++)if(n[r]==0)return!1;return!0},Shape3.Generate=function(e){var t;switch(e){case 0:t=new LShape3;break;case 1:t=new UShape3;break;case 2:t=new dShape3;break;case 3:t=new ManivelaShape3;break;case 4:t=new ForkShape3;break;case 5:t=new PlusShape3}return t};var LShape3=Shape3.extend({init:function(e){this._super(e),this.points.push(new Point3(0,0,0)),this.points.push(new Point3(0,0,1)),this.points.push(new Point3(0,1,0)),this.points.push(new Point3(0,2,0)),this.points.push(new Point3(0,3,0))}}),UShape3=Shape3.extend({init:function(e){this._super(e),this.points.push(new Point3(0,0,0)),this.points.push(new Point3(-1,0,0)),this.points.push(new Point3(1,0,0)),this.points.push(new Point3(-1,1,0)),this.points.push(new Point3(1,1,0)),Util.rand01()==1&&this.points.push(new Point3(1,2,0)),Util.rand01()==1&&this.points.push(new Point3(-1,2,0))}}),dShape3=Shape3.extend({init:function(e){this._super(e),this.points.push(new Point3(0,0,0)),this.points.push(new Point3(1,0,0)),this.points.push(new Point3(1,0,1)),this.points.push(new Point3(0,0,1)),this.points.push(new Point3(0,1,0)),Util.rand01()==1&&(this.points.push(new Point3(0,1,0)),this.points.push(new Point3(1,1,0)),this.points.push(new Point3(1,1,1)),this.points.push(new Point3(0,1,1)),this.points.push(new Point3(0,2,0)),this.points.push(new Point3(0,2,0)))}}),ManivelaShape3=Shape3.extend({init:function(e){this._super(e),this.points.push(new Point3(0,0,0)),this.points.push(new Point3(-1,0,0)),this.points.push(new Point3(1,0,0)),this.points.push(new Point3(1,1,0)),this.points.push(new Point3(1,1,-1)),this.points.push(new Point3(-1,-1,0)),this.points.push(new Point3(-1,-1,1))}}),ForkShape3=Shape3.extend({init:function(e){this._super(e),this.points.push(new Point3(0,0,0)),this.points.push(new Point3(-1,0,0)),this.points.push(new Point3(1,0,0)),this.points.push(new Point3(1,1,0)),this.points.push(new Point3(1,1,-1)),this.points.push(new Point3(-1,1,0)),this.points.push(new Point3(-1,1,-1)),this.points.push(new Point3(0,0,1))}}),PlusShape3=Shape3.extend({init:function(e){this._super(e),this.points.push(new Point3(0,0,0)),this.points.push(new Point3(1,0,0)),this.points.push(new Point3(0,1,0)),this.points.push(new Point3(0,0,1)),this.points.push(new Point3(-1,0,0)),this.points.push(new Point3(0,-1,0)),this.points.push(new Point3(0,0,-1))}}),AnimationShape=Shape3.extend({init:function(e){this._super(e),this.points.push(new Point3(0,0,0)),this.points.push(new Point3(-1,0,0)),this.points.push(new Point3(1,0,0)),this.points.push(new Point3(-1,1,0)),this.points.push(new Point3(1,1,0)),this.points.push(new Point3(1,2,0)),this.style=animationShapeStyle}});ShapePattern.prototype.drawAPiece=function(e,t){return PieceFactory({type:this.pieceType,upperLeftPosition:e,gridSize:t,style:this.pieceStyle,disableLayers:!0})};var Animation={images:[],init:function(e){Animation.container=e,Animation.initializePoints(),Animation.shape=new AnimationShape,Animation.shape.draw(new Point(200,125)),Animation.grids=new InteractiveGrids({size:30,position:new Point(425.5,10.5),rows:5,cols:5,style:{strokeColor:"#888"}}),Animation.sideText=new PointText(new Point(335,100)),Animation.sideText.set_style({justification:"center",fontSize:14});var t=[Animation.showFrontSide,Animation.showRightSide,Animation.showLeftSide,Animation.showUpSide,Animation.showBackSide],n=7e3;for(var r=0;r<t.length;r++)AnimationManager.delay(t[r],n*r+500+(r==0?1e3:0)),AnimationManager.delay(Animation.clean,n*(r+1)-1e3);Main.animationFinished(n*t.length)},recreateShape:function(){var e=new AnimationHelper({opacity:1});e.animate({style:{opacity:0},duration:500,delay:100,update:function(){Animation.shape.setOpacity(this.opacity)},callback:function(){Animation.shape.removeCubes(),Animation.shape=new AnimationShape,Animation.shape.draw(new Point(200,125)),Animation.shape.setOpacity(0),this.animate({style:{opacity:1},duration:500,delay:100,update:function(){Animation.shape.setOpacity(this.opacity)}})}})},clean:function(){Animation.grids.path&&Animation.grids.path.animate({style:{opacity:0},duration:500,callback:function(){this.remove()}}),Animation.changeText(""),Animation.recreateShape()},changeText:function(e,t,n){t||(t=500),Animation.sideText.animate({style:{opacity:0},duration:t/2,delay:n,callback:function(){this.content=e,this.animate({style:{opacity:1},duration:t/2})}})},showLeftSide:function(){Animation.changeText("soldan"),Animation.shape.showCorrectSide(Shape3.LeftSide),Animation.drawToGrids(Animation.leftPoints,1e3,3e3)},showRightSide:function(){Animation.changeText("sağdan"),Animation.shape.showCorrectSide(Shape3.RightSide),Animation.drawToGrids(Animation.leftPoints,1e3,3e3)},showUpSide:function(){Animation.changeText("üstten"),Animation.shape.showCorrectSide(Shape3.UpSide),Animation.drawToGrids(Animation.upPoints,1e3,3e3)},showDownSide:function(){Animation.changeText("alttan"),Animation.shape.showCorrectSide(Shape3.DownSide),Animation.drawToGrids(Animation.upPoints,1e3,3e3)},showFrontSide:function(){Animation.changeText("önden"),Animation.shape.flatten(1e3,1e3),Animation.drawToGrids(Animation.frontPoints,1e3,2e3)},showBackSide:function(){Animation.changeText("arkadan"),Animation.shape.showCorrectSide(Shape3.BackSide),Animation.drawToGrids(Animation.backPoints,1e3,2e3)},drawToGrids:function(e,t,n){t||(t=500),n||(n=0),AnimationManager.delay(function(){Animation.grids.drawShape(e),Animation.grids.path.opacity=0,Animation.grids.path.animate({style:{opacity:1},duration:t})},n)},initializePoints:function(){Animation.frontPoints=[new Point(1,2),new Point(1,3),new Point(1,4),new Point(2,4),new Point(3,4),new Point(4,4),new Point(4,3),new Point(4,2),new Point(4,1),new Point(3,1),new Point(3,2),new Point(3,3),new Point(2,3),new Point(2,2)],Animation.backPoints=[new Point(4,2),new Point(4,3),new Point(4,4),new Point(3,4),new Point(2,4),new Point(1,4),new Point(1,3),new Point(1,2),new Point(1,1),new Point(2,1),new Point(2,2),new Point(2,3),new Point(3,3),new Point(3,2)],Animation.leftPoints=[new Point(2,1),new 
Point(2,2),new Point(2,3),new Point(2,4),new Point(3,4),new Point(3,3),new Point(3,2),new Point(3,1)],Animation.upPoints=[new Point(1,2),new Point(2,2),new Point(3,2),new Point(4,2),new Point(4,3),new Point(3,3),new Point(2,3),new Point(1,3)]}},Interaction={getFramework:function(){return"paper"},FRONT:"onden",BACK:"arkadan",RIGHT:"sagdan",LEFT:"soldan",DOWN:"alttan",UP:"ustten",images:[],init:function(e){Interaction.container=e,Main.setObjective("Yandaki eş küplerle oluşturulmuş şeklin istenen yönde görünümünü kareli bölgede karelerin üzerine basarak çiziniz ve kontrol ediniz."),Interaction.paper={width:$(e).width(),height:$(e).height()},Interaction.appendButton({bottom:"15px",right:"40px"}),Interaction.appendStatus({bottom:"25px",right:"150px"}),Interaction.appendQuestion('<span id="side"></span>',{position:"absolute",left:"120px",top:"20px",fontWeight:"bold"}),Interaction.setRandomGenerator(6),Interaction.prepareNextQuestion()},nextQuestion:function(e){var t=null;switch(Util.randomInteger(0,6)){case 0:t=Shape3.FrontSide;break;case 1:t=Shape3.BackSide;break;case 2:t=Shape3.LeftSide;break;case 3:t=Shape3.RightSide;break;case 4:t=Shape3.UpSide;break;case 5:t=Shape3.DownSide}Interaction.setQuestionParams({id:"side",html:t}),Interaction.askedSide=t,Main.interactionProject.activeLayer.removeChildren(),Interaction.grids=new InteractiveGrids({position:new Point(332.5,15.5),size:27,style:{strokeColor:"#AAA"},pieceType:2,pieceStyle:{strokeWidth:2,strokeColor:"#000"}}),Interaction.grids.createTool("ShapePattern"),Interaction.shape=Shape3.Generate(e),Interaction.shape.draw(new Point(150,200))},preCheck:function(){},isAnswerCorrect:function(e){var t=Interaction.grids.getInputPattern().generateShapePoints(),n=Interaction.shape.getMinimizedFlattedPoints(Interaction.askedSide).normalizePoints();return t.equals(n)},onCorrectAnswer:function(){Interaction.showCorrectAnswer()},onWrongAnswer:function(){},onFail:function(){Interaction.setStatus("Yanlış cevap. Doğrusu şekil üzerinde gösterilecektir.",!1),Interaction.showCorrectAnswer()},showCorrectAnswer:function(){Interaction.pause(),Interaction.shape.showCorrectSide(Interaction.askedSide)}};