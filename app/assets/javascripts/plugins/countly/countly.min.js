function SegmentationObject(){this.Key,this.Value,this.Init=function(a,b){this.Key=a,this.Value=b}}function CountlyEvent(){this.Key,this.Count,this.UsingSum,this.Sum,this.UsingSegmentation,this.Segmentation=[]}function DeviceInformation(){this.UDID=7,this.OS,this.OSVersion,this.Device,this.Resolution,this.Carrier=null,this.Locale,this.ScreenWidth=screen.width,this.ScreenHeight=screen.height}function Sleep(a){var b=new Date;for(b.setTime(b.getTime()+a);(new Date).getTime()<b.getTime(););}CountlyEvent.prototype.Init=function(){},DeviceInformation.prototype.DetectDevice=function(){var a=navigator.userAgent;if(window.devicePixelRatio>1&&(this.ScreenWidth*=window.devicePixelRatio,this.ScreenHeight*=window.devicePixelRatio),this.Resolution=this.ScreenWidth>this.ScreenHeight?"{0}x{1}".format(this.ScreenWidth,this.ScreenHeight):"{0}x{1}".format(this.ScreenHeight,this.ScreenWidth),this.Locale=window.navigator.userLanguage||window.navigator.language,/iPhone|iPad|iPod/i.test(a))if(this.OS="iOS",this.OSVersion=/(i[PSa-z\s]+);.*?CPU\s([OSPa-z\s]+(?:([\d_]+)|;))/i.exec(a).lenght>3?a.match(/(i[PSa-z\s]+);.*?CPU\s([OSPa-z\s]+(?:([\d_]+)|;))/i)[3].replaceAll("_","."):"Unknown",/iPhone/i.test(a))switch(this.Resolution){case"1136x640":this.Device="iPhone 5";break;case"480x320":this.Device="iPhone 3G/S";break;case"960x640":this.Device="iPhone 4G/S";break;default:this.Device="iPhone"}else if(/iPad/i.test(a))switch(window.devicePixelRatio){case 1:this.Device="iPad 1/2";break;case 2:this.Device="iPad 3";break;default:this.Device="iPad"}else/iPod/i.test(a)&&(this.Device="iPod");else if(/Android/i.test(a))this.Device="Android",this.OS="Android OS",this.OSVersion=/Android\s+([\d\.]+)/.test(a)?a.match(/Android\s+([\d\.]+)/)[1]:"Unknown";else if(/blackberry|BB10|rim tablet os/i.test(a))this.Device="Blackberry",this.OS="BlackBerry OS",this.OSVersion="Unknown";else if(/Symbian|SymbOS|Series60|Series40|SYB-[0-9]+|\bS60\b/i.test(a))this.Device="Symbian",this.OS="Symbian OS",this.OSVersion="Unknown";else if(/Windows CE.*(PPC|Smartphone|Mobile|[0-9]{3}x[0-9]{3})|Window Mobile|Windows Phone [0-9.]+|WCE;/i.test(a))this.Device="Windows Mobile",this.OS="Windows Mobile OS",this.OSVersion="Unknown";else if(/Windows Phone OS|XBLWP7|ZuneWP7/i.test(a))this.Device="Windows Phone",this.OS="Windows Phone OS",this.OSVersion=/Windows Phone OS\s+([\d\.]+)/.test(a)?a.match(/Windows Phone OS\s+([\d\.]+)/)[1]:"Unknown";else if(/PalmOS|avantgo|blazer|elaine|hiptop|palm|plucker|xiino/i.test(a))this.Device="Palm",this.OS="Palm OS",this.OSVersion="Unknown";else if(/Windows/i.test(a))if(this.Device="PC",this.OS="Windows",/Windows NT\s+([\d\.]+)/.test(a))switch(/Windows NT\s+([\d\.]+)/.exec(a)[1]){case"5.1":this.OSVersion="XP";break;case"6.0":this.OSVersion="Vista";break;case"6.1":this.OSVersion="7";break;case"6.2":this.OSVersion="8";break;default:this.OSVersion="Unknown"}else this.OSVersion="Unknown";else if(/Mac/i.test(a))if(this.Device="Mac",this.OS="Mac OS X",/Mac OS X\s+([\w._]+)/.test(a))switch(/Mac OS X\s+([\w._]+)/.exec(a)[1]){case"10_4":this.OSVersion="Tiger";break;case"10_5":this.OSVersion="Leopard";break;case"10_6":this.OSVersion="Snow Leopard";break;case"10_7":this.OSVersion="Mountain Lion";break;case"10_8":this.OSVersion="Mountain Lion 8";break;default:this.OSVersion="Unknown"}else this.OSVersion="Unknown";else/X11/i.test(a)?(this.Device="PC",this.OS="Unix",this.OSVersion="Unknown"):/Linux/i.test(a)&&(this.Device="PC",this.OS="Linux",this.OSVersion="Unknown");Countly.Log("OS:{0}, OS Version:{1}, Device:{2}, UDID:{6} Resolution:{3}, Carrier:{4}, Locale:{5}".format(this.OS,this.OSVersion,this.Device,this.Resolution,this.Carrier,this.Locale,this.UDID))},DeviceInformation.prototype.GetMetrics=function(a){var b="{";return b+='"_device":"'+this.Device+'"',b+=',"_os":"'+this.OS+'"',b+=',"_os_version":"'+this.OSVersion+'"',b+=',"_carrier":"'+this.Carrier+'"',b+=',"_resolution":"'+this.Resolution+'"',b+=',"_local":"'+this.Locale+'"',b+=',"_app_version":"'+a+'"',b+="}",Countly.Log(b),b},String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return a[c]!==void 0?a[c]:b})}),String.prototype.replaceAll=function(a,b){return this.replace(RegExp(a,"g"),b)};var Countly=new function(){this.ServerURL="https://cloud.count.ly",this.AppKey="",this.AppVersion="1.01",this.DataCheckPeriod=10,this.KeepAliveSendPeriod=30,this.IsDebugModeOn=!0,this.ConnectionQueue=[],this.IsCountlyWorking,this.PackageSizeForEvents=5,this._eventQueue=[],this.Duration,this.CanSendDataToServer,this.DeviceInfo,this.Log=function(a){this.IsDebugModeOn&&console.log("Countly -> {0}".format(a))},this.SendDataToServer=function(){var a;if(this.CanSendDataToServer){for(;this.ConnectionQueue.length>0;)a=this.ConnectionQueue.pop(),this.Send(a);setTimeout(function(){Countly.SendDataToServer()},1e3*Countly.DataCheckPeriod)}},this.Send=function(a){this.Log("call -> {0}".format(a)),$.ajax({type:"POST",url:"{0}/i?{1}".format(this.ServerURL,a),contentType:"application/json; charset=utf-8",dataType:"json",success:function(){Countly.Log("Data send successfully.")},error:function(a){Countly.ConnectionQueue.push(a)}})},this.SeriliazeEvents=function(a){var b="",c=!0;b+="[";for(var d in a){if(c?c=!1:b+=",",Countly.Log("Event:  "+a[d].Key),b+="{",b+='"key":"'+a[d].Key+'"'+",",b+='"count":'+a[d].Count,a[d].UsingSum&&(b+=",",b+='"sum":'+a[d].Sum),a[d].UsingSegmentation){b+=",",b+='"segmentation":{',first2=!0;for(var e in a[d].Segmentation)first2?first2=!1:b+=",",b+='"'+a[d].Segmentation[e].Key+'"'+":"+'"'+a[d].Segmentation[e].Value+'"';b+="}"}b+="}"}return b+="]",Countly.Log(b),b},this.Init=function(a,b,c){this.ServerURL=a,this.AppKey=b,this.AppVersion=c,this.DeviceInfo=new DeviceInformation,this.DeviceInfo.DetectDevice()},this.Init=function(a,b,c,d){this.ServerURL=a,this.AppKey=b,this.AppVersion=c,this.DeviceInfo=new DeviceInformation,this.DeviceInfo.DetectDevice(),this.DeviceInfo.UDID=d},this.OnStart=function(){if(!this.IsCountlyWorking){if(this.Log("Starting..."),""==this.ServerURL||""==this.AppKey||""==this.AppVersion)return this.Log("Please fill ServerURL, AppKey and AppVersion values with Init() method."),void 0;this.BeginSession(),this.IsCountlyWorking=!0,setTimeout(function(){Countly.KeepAlive()},1e3*Countly.KeepAliveSendPeriod),this.CanSendDataToServer=!0,this.Duration=0,this.UpdateDuration(),this.SendDataToServer()}},this.OnStop=function(){this.IsCountlyWorking&&(this.Log("Stopping..."),this.IsCountlyWorking=!1,this.EndSession())},this.PostEvent=function(a){null!=a&&(this.Log("Event Queued -> "+a.Key+" : "+a.Count),this._eventQueue.push(a),this._eventQueue.length>=this.PackageSizeForEvents&&(this.QueueEvents(),this._eventQueue=[]))},this.KeepAlive=function(){this.IsCountlyWorking&&(this.Log("Keeping Alive..."),this.UpdateSession(),setTimeout(function(){Countly.KeepAlive()},1e3*Countly.KeepAliveSendPeriod))},this.UpdateDuration=function(){this.IsCountlyWorking&&(this.Duration++,setTimeout(function(){Countly.UpdateDuration()},1e3))},this.BeginSession=function(){var a="app_key={0}&device_id={1}&sdk_version=1.0&begin_session=1&metrics={2}".format(this.AppKey,this.DeviceInfo.UDID,encodeURIComponent(this.DeviceInfo.GetMetrics(this.AppVersion)));this.Log("Begin Session"),this.ConnectionQueue.push(a)},this.UpdateSession=function(){var a="app_key={0}&device_id={1}&session_duration={2}".format(this.AppKey,this.DeviceInfo.UDID,this.Duration);if(this._eventQueue.length>0){var b=this.SeriliazeEvents(this._eventQueue);this._eventQueue=[],a+="&events="+encodeURIComponent(b)}this.Duration=0,this.Log("Update Session"),this.ConnectionQueue.push(a)},this.EndSession=function(){var a="app_key={0}&device_id={1}&end_session=1&session_duration={2}".format(this.AppKey,this.DeviceInfo.UDID,this.Duration);if(this._eventQueue.length>0){var b=this.SeriliazeEvents(this._eventQueue);this._eventQueue=[],a+="&events="+encodeURIComponent(b)}this.Log("End Session"),this.Send(a,function(){this.CanSendDataToServer=!1,this.ConnectionQueue=[],this.Duration=0})},this.QueueEvents=function(){var a="app_key={0}&device_id={1}&events={2}".format(this.AppKey,this.DeviceInfo.UDID,encodeURIComponent(this.SeriliazeEvents(this._eventQueue)));this.Log("Events are packaged. Package is sending..."),this.ConnectionQueue.push(a)}};